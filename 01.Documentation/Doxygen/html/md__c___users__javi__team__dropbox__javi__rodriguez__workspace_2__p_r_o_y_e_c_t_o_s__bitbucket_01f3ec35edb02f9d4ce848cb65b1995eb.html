<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Battery doc: I2CShell</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Battery doc
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__c___users__javi__team__dropbox__javi__rodriguez__workspace_2__p_r_o_y_e_c_t_o_s__bitbucket_01f3ec35edb02f9d4ce848cb65b1995eb.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">I2CShell </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >I2CShell allows you to interact with I2C devices from the console, similar to what you can do with the Bus Pirate. You can type in a line such as </p><pre class="fragment">[ 0x10 5 [ 0x11 r:3 ]
</pre><p> This will address the I2C device under (8-bit) address 0x10, corresponding to 7-bit address 0x08 in writing direction, and send 0x05 to the device. After that the device is again addressed with a repeated start in reading direction and 3 bytes are requested. The output could look like as follows: </p><pre class="fragment">Start: 0x10 (0x08!) + ACK
Write: 0x05 + ACK
Rep. start: 0x11 (0x08?) + ACK
Read: 0x10 + ACK
Read: 0x5A + ACK
Read: 0x98 + NAK
Stop
</pre><h1><a class="anchor" id="autotoc_md124"></a>
Installation and configuration</h1>
<p ><code>I2CShell</code> is part of the bit-banging I2C library <a href="https://github.com/felias-fogg/SoftI2CMaster">SoftI2CMaster</a>. After downloading this library, you find I2CShell as one of the examples in the <code>examples</code> folder.</p>
<p >Before you use the sketch, you should probably adjust some of the compile-time constants in the sketch. </p><pre class="fragment">USEEEPROM
</pre><p> If 1 (the default), macros are stored in EEPROM so that they survive program exits. If 0, the EEPROM contents is not touched. </p><pre class="fragment">I2C_HARDWARE
</pre><p> If 1 (default), the I2C hardware support is used instead of the bit-banging version of the I2C library. This gives a little bit more flexibility (concerning clock frequency and pullup resistors), but restricts you to use the standard I2C pins SDA and SCL. </p><pre class="fragment">I2C_TIMEOUT
</pre><p> If 0, I2C operations do not time out. The default value is 100 (milliseconds). It is safe to leave it this way. </p><pre class="fragment">I2C_PULLUP
</pre><p> If 1 (the default), then the MCU internal pullups are activated. This is safe as long as you do not connect 3 Volt devices that get destroyed by higher voltage.</p>
<p >Finally, there are the four constants to determine the I2C pins when you use the bit-banging version of the I2C library (i.e. I2C_HARDWARE is 0). These pins have to be specified in a way so that <a href="http://www.arduino.cc/en/Reference/PortManipulation">port manipulation commands</a> can be used. Instead of specifying the number of the digital pin (0-19), the <em>port</em> (PORTB, PORTC, PORTD) and the <em>port pin</em> has to be specified. The mapping is explained <a href="http://www.arduino.cc/en/Reference/PortManipulation">here</a>. For example, if you want to use <em>digital pin 2</em> for <em>SCL</em> and <em>digital pin 14</em> (= analog pin 0) for <em>SDA</em>, you have to specify <em>port pin 2 of PORTD</em> for SCL and <em>port pin 0 of PORTC</em> for SDA. </p><pre class="fragment">#define SCL_PIN 2
#define SCL_PORT PORTD
#define SDA_PIN 0
#define SDA_PORT PORTC
</pre><p >Note that all the compile time constants have to be placed before the inclusion of the <code>SoftI2CMaster</code> library.</p>
<h1><a class="anchor" id="autotoc_md125"></a>
Commands</h1>
<p >You can use I2CShell either with Arduino's serial monitor or with an ordinary terminal program (e.g. <code>screen</code> under Unix). Baudrate is 115200, 8 bits, 1 stop bit, no parity bit.</p>
<p >In the following _&lt;digit&gt;_ denotes a single decimal digit and *&lt;number&gt;* denotes a non-negative number in the usual notation, i.e., 17, 0x11, 0X11, 0o21, or 0b10001 can all be written in order to refer to the decimal number seventeen. As a means to make life easier when converting between 8-bit and 7-bit addresses, one can postfix a number with <code>!</code> or <code>?</code> in order to signify the write, resp. read direction together with a 7-bit address. This means that, e.g. 0x10 can also be written as 0x08! and 0x11 as 0x08?. In general, the input is case insensitive.</p>
<p >There are a number of commands that one can use to interact with the program in order to configure it and to access the I2C bus:</p>
<ul>
<li><code>H</code> gives a short help screen.</li>
<li><code>S</code> scans the I2C bus for devices. Reports under which addresses the program receives an ACK.</li>
<li><code>T</code> prints last execution trace again.</li>
<li><code>T&lt;number&gt;</code> prints 20 commands of the last execution trace starting at command &lt;number&gt; (numbering starts at command 0).</li>
<li><code>&lt;digit&gt;=...</code> defines a macro under the single digit identifier &lt;digit&gt;. These macros can be used later inside I2C command strings.</li>
<li><code>L</code> lists all macros.</li>
<li><code>L&lt;digit&gt;</code> lists the macro with identifier &lt;digit&gt;. <br  />
</li>
<li><code>P</code> shows status of pullup resistors.</li>
<li><code>P&lt;digit&gt;</code> enables the pullups (1) or disables them (0). Works only if the hardware interface has been enabled (I2C_HARDWARE must be 1).</li>
<li><code>F</code> reports the I2C clock frequency.</li>
<li><code>F&lt;number&gt;</code> sets the I2C clock frequency to &lt;number&gt; kHz. Works only if the hardware interface has been enabled.</li>
</ul>
<h1><a class="anchor" id="autotoc_md126"></a>
I2C interaction</h1>
<p >You can write one line (of 80 characters) of I2C commands that is sent to the I2C bus after you finish the line with the &lt;Return&gt; key. The results are recorded and then presented in the terminal window, as shown above. There exist the following commands:</p>
<ul>
<li><code>[</code> Issue a start condition; this is needed in order to claim access to the bus and is always followed by an I2C device address.</li>
<li><code>{</code> Issue start conditions until the addressed device responds with an ACK. The maximum number of repetitions is 255.</li>
<li><code>]</code> Issue a stop condition, which releases the bus.</li>
<li><code>&lt;number&gt;</code> Send one byte to the I2C bus; the receipt of the byte will be acknowledged by the receiving device with an ACK.</li>
<li><code>R</code> Read one byte from the addressed I2C device. The NAK for the last byte will be automatically generated.</li>
<li><code>&amp;</code> Wait for a microsecond.</li>
<li><code>%</code> Wait for a millisecond.</li>
<li><code>:&lt;number&gt;</code> Repeat the previous command &lt;number&gt; times. This is not allowed for start conditions and previous repetitions.</li>
<li><code>(&lt;digit&gt;)</code> Execute macro.</li>
</ul>
<p >Between commands, one can put commas and blanks in order to make the line more readable. The only point when you have to use such separators is when two numbers are adjacent.</p>
<h1><a class="anchor" id="autotoc_md127"></a>
Edit commands</h1>
<p >When using a terminal window, there are also a number of edit commands one can use:</p>
<ul>
<li><code>Ctrl-A</code> or <code>UP arrow</code> Go to start of line.</li>
<li><code>Ctrl-E</code> or <code>DOWN arrow</code> Go to end on line.</li>
<li><code>Ctrl-B</code> or <code>LEFT arrow</code> Go one character backward.</li>
<li><code>Ctrl-F</code> or <code>RIGHT arrow</code> Go one character forward.</li>
<li><code>Ctrl-H</code> or <code>DELETE</code> Delete last character.</li>
<li><code>Ctrl-D</code> Delete character under cursor.</li>
<li><code>Ctrl-K</code> Kill rest of line.</li>
<li><code>Ctrl-P</code> If typed before anything else is written, the last line is retrieved and can be edited.</li>
<li><code>$&lt;digit&gt;</code> Inserts the macro &lt;digit&gt; at this point into the line. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
