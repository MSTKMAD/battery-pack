<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Battery doc: FlashStorage library for Arduino</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Battery doc
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__c___users__javi__team__dropbox__javi__rodriguez__workspace_2__p_r_o_y_e_c_t_o_s__bitbucket_09ea0d65c066462778ba41e07f3878ae9.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">FlashStorage library for Arduino </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The FlashStorage library aims to provide a convenient way to store and retrieve user's data using the non-volatile flash memory of microcontrollers.</p>
<p >The flash memory, due to it's properties, is generally used to store the firmware code, but it can also be used to store user data.</p>
<h1><a class="anchor" id="autotoc_md90"></a>
Supported hardware</h1>
<p >Currently, ATSAMD21 and ATSAMD51 cpu are supported (and consequently every board based on this cpu like the Arduino Zero or Aduino MKR1000).</p>
<h1><a class="anchor" id="autotoc_md91"></a>
Limited number of writes</h1>
<p >Flash memory has a limited amount of write cycles. Typical flash memory can perform about 10000 writes cycles to the same flash block before starting to "wear out" and begin to lose the ability to retain data.</p>
<p >So <b>BEWARE: IMPROPER USE OF THIS LIBRARY CAN QUICKLY AND PERMANENTLY DESTROY THE FLASH MEMORY OF YOUR MICRO</b>, in particular you should avoid to call the <code>write()</code> function too often and make sure that in the entire life of the micro the number of calls to <code>write</code> stay well below the above limit of 10000 (it's a good rule-of-thumb to keep that number in mind even if the manufacturer of the micro guarantees a bigger number of cycles).</p>
<p >The same caution must be taken if you're using the EEPROM API emulation (see below) with the <code>EEPROM.commit()</code> function.</p>
<h1><a class="anchor" id="autotoc_md92"></a>
Usage</h1>
<p >First of all you must declare a global <code>FlashStorage</code> object for each piece of data you intend to store in the flash memory. For example if you want to store the age of a person you must declare an <code>age_storage</code> like this:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">FlashStorage(age_storage, int);</div>
</div><!-- fragment --><p >this instruction means "create a `FlashStorage` to store an `int` variable and call
it `age_storage`". Now you can use <code>age_storage</code> as a place to safely store an integer:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">void readAndStoreUserAge() {</div>
<div class="line">  Serial.println(&quot;Please enter your age:&quot;);</div>
<div class="line">  String age = Serial.readStringUntil(&#39;\n&#39;);</div>
<div class="line"> </div>
<div class="line">  age_storage.write(age.toInt());  // &lt;-- save the age</div>
<div class="line">}</div>
</div><!-- fragment --><p >after a reset of the microcontroller you can retrieve the stored age by using:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">int user_age = age_storage.read();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md93"></a>
Using the alternative EEPROM-like API</h2>
<p >If you include <code>FlashAsEEPROM.h</code> you'll get an EEPROM emulation with the internal flash memory. See <a href="https://github.com/cmaglie/FlashStorage/tree/master/examples/EmulateEEPROM/EmulateEEPROM.ino">EmulateEEPROM</a> sketch for an example.</p>
<p >The API is very similar to the well known Arduino EEPROM.h API but with two additional functions:</p>
<ul>
<li><code>EEPROM.isValid()</code> returns <code>true</code> if data in the EEPROM is valid or, in other words, if the data has been written at least once, otherwise EEPROM data is "undefined" and the function returns <code>false</code>.</li>
<li><code>EEPROM.commit()</code> store the EEPROM data in flash. Use this with care: Every call writes the complete EEPROM data to flash. This will reduce the remaining flash-write-cycles. Don't call this method in a loop or <a href="https://github.com/cmaglie/FlashStorage#limited-number-of-writes">you will kill your flash soon</a>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md94"></a>
License</h1>
<p >This library is released under LGPL-2.1.</p>
<h1><a class="anchor" id="autotoc_md95"></a>
FAQ</h1>
<h2><a class="anchor" id="autotoc_md96"></a>
Can I use a single FlashStorage object to store more stuff?</h2>
<p >Yes, you can declare a <code>struct</code> with more fields and create a <code>FlashStorage</code> object to store the entire structure. See the <a href="https://github.com/cmaglie/FlashStorage/tree/master/examples/StoreNameAndSurname/StoreNameAndSurname.ino">StoreNameAndSurname</a> sketch for an example on how to do it.</p>
<h2><a class="anchor" id="autotoc_md97"></a>
The content of the FlashStorage is erased each time a new sketch is uploaded?</h2>
<p >Yes, every time you upload a new sketch, the previous content of the FlashStorage is erased and filled with 0's. The FlashStorage library does not allow to set another default value.</p>
<h2><a class="anchor" id="autotoc_md98"></a>
Do you recommend to use FLASH instead of EEPROM?</h2>
<p >No. If your micro provides an EEPROM it's almost always better to use that because it's a kind of memory designed with the specific purpose to store user data (it has a longer lifetime, number of write cycles, etc...).</p>
<p >In the absence of an EEPROM you can use this library to use a piece of the flash memory as an alternative to EEPROM. However, you must always keep in mind of it's limits. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
