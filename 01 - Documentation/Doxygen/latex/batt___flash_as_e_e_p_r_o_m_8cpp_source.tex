\hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source}{}\doxysection{batt\+\_\+\+Flash\+As\+EEPROM.\+cpp}
\label{batt___flash_as_e_e_p_r_o_m_8cpp_source}\index{C:/Users/Javi/Team Dropbox/Javi Rodriguez/Workspace/2-\/PROYECTOS/Bitbucket/03-\/Battery Pack/bat\_sw/LIBRARIES/0012-\/batt\_FlashStorage/src/batt\_FlashAsEEPROM.cpp@{C:/Users/Javi/Team Dropbox/Javi Rodriguez/Workspace/2-\/PROYECTOS/Bitbucket/03-\/Battery Pack/bat\_sw/LIBRARIES/0012-\/batt\_FlashStorage/src/batt\_FlashAsEEPROM.cpp}}
\mbox{\hyperlink{batt___flash_as_e_e_p_r_o_m_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00001}00001 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00002}00002 \textcolor{comment}{  EEPROM like API that uses Arduino Zero's flash memory.}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00003}00003 \textcolor{comment}{  Written by A. Christian}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00004}00004 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00005}00005 \textcolor{comment}{  Copyright (c) 2015-\/2016 Arduino LLC.  All right reserved.}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00006}00006 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00007}00007 \textcolor{comment}{  This library is free software; you can redistribute it and/or}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00008}00008 \textcolor{comment}{  modify it under the terms of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00009}00009 \textcolor{comment}{  License as published by the Free Software Foundation; either}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00010}00010 \textcolor{comment}{  version 2.1 of the License, or (at your option) any later version.}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00011}00011 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00012}00012 \textcolor{comment}{  This library is distributed in the hope that it will be useful,}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00013}00013 \textcolor{comment}{  but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00014}00014 \textcolor{comment}{  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00015}00015 \textcolor{comment}{  See the GNU Lesser General Public License for more details.}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00016}00016 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00017}00017 \textcolor{comment}{  You should have received a copy of the GNU Lesser General Public}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00018}00018 \textcolor{comment}{  License along with this library; if not, write to the Free Software}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00019}00019 \textcolor{comment}{  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-\/1301  USA}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00020}00020 \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00021}00021 }
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00022}00022 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{batt___flash_as_e_e_p_r_o_m_8h}{batt\_FlashAsEEPROM.h}}"{}}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00024}\mbox{\hyperlink{batt___flash_as_e_e_p_r_o_m_8cpp_a6edf556f27dd7bb4ad1b26e56fb1983a}{00024}} \mbox{\hyperlink{batt___flash_as_e_e_p_r_o_m_8cpp_a6edf556f27dd7bb4ad1b26e56fb1983a}{FlashStorage}}(eeprom\_storage, \mbox{\hyperlink{struct_e_e_p_r_o_m___e_m_u_l_a_t_i_o_n}{EEPROM\_EMULATION}});}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00026}\mbox{\hyperlink{class_e_e_p_r_o_m_class_a6a2fcfebd6ba13350fac9b8e1851e637}{00026}} \mbox{\hyperlink{class_e_e_p_r_o_m_class_a6a2fcfebd6ba13350fac9b8e1851e637}{EEPROMClass::EEPROMClass}}(\textcolor{keywordtype}{void}) : \_initialized(false), \mbox{\hyperlink{diagnostic_8h_ad9d7d92a6dc33a9bf186020af3053844}{\_dirty}}(false) \{}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00027}00027   \textcolor{comment}{// Empty}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00028}00028 \}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00029}00029 }
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00030}\mbox{\hyperlink{class_e_e_p_r_o_m_class_aa504020e188bc95dc1d555c6dc254d28}{00030}} uint8\_t \mbox{\hyperlink{class_e_e_p_r_o_m_class_aa504020e188bc95dc1d555c6dc254d28}{EEPROMClass::read}}(\textcolor{keywordtype}{int} address)}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00031}00031 \{}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00032}00032   \textcolor{keywordflow}{if} (!\_initialized) init();}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00033}00033   \textcolor{keywordflow}{return} \_eeprom.\mbox{\hyperlink{struct_e_e_p_r_o_m___e_m_u_l_a_t_i_o_n_a4ced6b3ddbdd91e538d73cab39cd0f5b}{data}}[address];}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00034}00034 \}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00036}\mbox{\hyperlink{class_e_e_p_r_o_m_class_af26f78751c034f5112bb6886ddad77af}{00036}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_e_e_p_r_o_m_class_af26f78751c034f5112bb6886ddad77af}{EEPROMClass::update}}(\textcolor{keywordtype}{int} address, uint8\_t value)}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00037}00037 \{}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00038}00038   \textcolor{keywordflow}{if} (!\_initialized) init();}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00039}00039   \textcolor{keywordflow}{if} (\_eeprom.\mbox{\hyperlink{struct_e_e_p_r_o_m___e_m_u_l_a_t_i_o_n_a4ced6b3ddbdd91e538d73cab39cd0f5b}{data}}[address] != value) \{}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00040}00040     \_dirty = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00041}00041     \_eeprom.\mbox{\hyperlink{struct_e_e_p_r_o_m___e_m_u_l_a_t_i_o_n_a4ced6b3ddbdd91e538d73cab39cd0f5b}{data}}[address] = value;}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00042}00042   \}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00043}00043 \}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00045}\mbox{\hyperlink{class_e_e_p_r_o_m_class_a8ebe57942be10984c8fb6ed4b55fe69d}{00045}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_e_e_p_r_o_m_class_a8ebe57942be10984c8fb6ed4b55fe69d}{EEPROMClass::write}}(\textcolor{keywordtype}{int} address, uint8\_t value)}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00046}00046 \{}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00047}00047   \mbox{\hyperlink{class_e_e_p_r_o_m_class_af26f78751c034f5112bb6886ddad77af}{update}}(address, value);}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00048}00048 \}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00049}00049 }
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00050}00050 \textcolor{keywordtype}{void} EEPROMClass::init()}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00051}00051 \{}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00052}00052   \_eeprom = eeprom\_storage.read();}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00053}00053   \textcolor{keywordflow}{if} (!\_eeprom.\mbox{\hyperlink{struct_e_e_p_r_o_m___e_m_u_l_a_t_i_o_n_a58b055828a3601ef45ff74daccd0a226}{valid}}) \{}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00054}00054     memset(\_eeprom.\mbox{\hyperlink{struct_e_e_p_r_o_m___e_m_u_l_a_t_i_o_n_a4ced6b3ddbdd91e538d73cab39cd0f5b}{data}}, 0xFF, \mbox{\hyperlink{diagnostic_8h_aeef7979c9f1e33313c8a2d6eb9fc5dee}{EEPROM\_EMULATION\_SIZE}});}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00055}00055   \}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00056}00056   \_initialized = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00057}00057 \}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00058}00058 }
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00059}\mbox{\hyperlink{class_e_e_p_r_o_m_class_a450c24cc5879179cd3a821719456dad2}{00059}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_e_e_p_r_o_m_class_a450c24cc5879179cd3a821719456dad2}{EEPROMClass::isValid}}()}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00060}00060 \{}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00061}00061   \textcolor{keywordflow}{if} (!\_initialized) init();}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00062}00062   \textcolor{keywordflow}{return} \_eeprom.\mbox{\hyperlink{struct_e_e_p_r_o_m___e_m_u_l_a_t_i_o_n_a58b055828a3601ef45ff74daccd0a226}{valid}};}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00063}00063 \}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00064}00064 }
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00065}\mbox{\hyperlink{class_e_e_p_r_o_m_class_aa5c8b05b0e23c925f80a57b9bf5118c1}{00065}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_e_e_p_r_o_m_class_aa5c8b05b0e23c925f80a57b9bf5118c1}{EEPROMClass::commit}}()}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00066}00066 \{}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00067}00067   \textcolor{keywordflow}{if} (!\_initialized) init();}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00068}00068   \textcolor{keywordflow}{if} (\_dirty) \{}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00069}00069     \_eeprom.\mbox{\hyperlink{struct_e_e_p_r_o_m___e_m_u_l_a_t_i_o_n_a58b055828a3601ef45ff74daccd0a226}{valid}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00070}00070     eeprom\_storage.write(\_eeprom);}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00071}00071   \}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00072}00072 \}}
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00073}00073 }
\DoxyCodeLine{\Hypertarget{batt___flash_as_e_e_p_r_o_m_8cpp_source_l00074}\mbox{\hyperlink{batt___flash_as_e_e_p_r_o_m_8cpp_a8c17b9f346b7ef4b4c79d467de251bec}{00074}} \mbox{\hyperlink{class_e_e_p_r_o_m_class}{EEPROMClass}} \mbox{\hyperlink{batt___flash_as_e_e_p_r_o_m_8cpp_a8c17b9f346b7ef4b4c79d467de251bec}{EEPROM}};}

\end{DoxyCode}
