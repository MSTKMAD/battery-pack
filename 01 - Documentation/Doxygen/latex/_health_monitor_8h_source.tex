\hypertarget{_health_monitor_8h_source}{}\doxysection{Health\+Monitor.\+h}
\label{_health_monitor_8h_source}\index{C:/Users/Javi/Team Dropbox/Javi Rodriguez/Workspace/2-\/PROYECTOS/Bitbucket/03-\/Battery Pack/bat\_sw/LIBRARIES/0005-\/SENSING/HealthMonitor.h@{C:/Users/Javi/Team Dropbox/Javi Rodriguez/Workspace/2-\/PROYECTOS/Bitbucket/03-\/Battery Pack/bat\_sw/LIBRARIES/0005-\/SENSING/HealthMonitor.h}}
\mbox{\hyperlink{_health_monitor_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00011}00011 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{batt___s_a_m_d___analog_correction_8h}{batt\_SAMD\_AnalogCorrection.h}}>}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00012}00012 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00013}\mbox{\hyperlink{_health_monitor_8h_a3755f09042885d550c508cf380ee8984}{00013}} \textcolor{keyword}{const} int16\_t \mbox{\hyperlink{_health_monitor_8h_a3755f09042885d550c508cf380ee8984}{C\_TIME\_HEALTH\_MONITORING}} = 50; \textcolor{comment}{// ms}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00014}\mbox{\hyperlink{_health_monitor_8h_ab636c8bba67427e5e3e9c5555e083a5f}{00014}} \textcolor{keyword}{const} int16\_t \mbox{\hyperlink{_health_monitor_8h_ab636c8bba67427e5e3e9c5555e083a5f}{C\_SAMPLING\_TIME}} = 10;          \textcolor{comment}{// ms}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00015}00015 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00016}\mbox{\hyperlink{_health_monitor_8h_a3066de0872e48de34d6184e9fffda49b}{00016}} \textcolor{keyword}{const} int16\_t \mbox{\hyperlink{_health_monitor_8h_a3066de0872e48de34d6184e9fffda49b}{C\_RISE\_COUNT}} = 20;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00018}\mbox{\hyperlink{_health_monitor_8h_a9d401d356b9137e774ca9b0dc4792f9c}{00018}} \textcolor{keyword}{const} int16\_t \mbox{\hyperlink{_health_monitor_8h_a9d401d356b9137e774ca9b0dc4792f9c}{C\_COUNTER\_LIMIT}} = \mbox{\hyperlink{_health_monitor_8h_a3066de0872e48de34d6184e9fffda49b}{C\_RISE\_COUNT}} * \mbox{\hyperlink{_health_monitor_8h_a3755f09042885d550c508cf380ee8984}{C\_TIME\_HEALTH\_MONITORING}} / \mbox{\hyperlink{_health_monitor_8h_ab636c8bba67427e5e3e9c5555e083a5f}{C\_SAMPLING\_TIME}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00019}00019 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00020}\mbox{\hyperlink{class_health_monitor}{00020}} \textcolor{keyword}{class }\mbox{\hyperlink{class_health_monitor}{HealthMonitor}}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00021}00021 \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00022}00022   \textcolor{comment}{// Class Member Variables}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00023}00023   uint16\_t counter; \textcolor{comment}{// private, only accesible by setCounter method}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00025}00025 \textcolor{keyword}{public}:}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00026}\mbox{\hyperlink{class_health_monitor_a74cb75281de6403101b1532d82d083da}{00026}}   uint16\_t \mbox{\hyperlink{class_health_monitor_a74cb75281de6403101b1532d82d083da}{threshold}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00027}\mbox{\hyperlink{class_health_monitor_a2105621201b3b30dc9aa941fbbda38cd}{00027}}   uint8\_t \mbox{\hyperlink{class_health_monitor_a2105621201b3b30dc9aa941fbbda38cd}{rampUPinc}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00028}\mbox{\hyperlink{class_health_monitor_aa966d7d0797fd39871e4985e0cc06eb0}{00028}}   uint8\_t \mbox{\hyperlink{class_health_monitor_aa966d7d0797fd39871e4985e0cc06eb0}{rampDOWNdec}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00029}\mbox{\hyperlink{class_health_monitor_a5c26a9b437db52f219e333f42248417f}{00029}}   uint16\_t \mbox{\hyperlink{class_health_monitor_a5c26a9b437db52f219e333f42248417f}{limit}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00030}\mbox{\hyperlink{class_health_monitor_a2a0e47f0300e57780b8c2eff36b1a300}{00030}}   \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_health_monitor_a2a0e47f0300e57780b8c2eff36b1a300}{alarm}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00031}\mbox{\hyperlink{class_health_monitor_ac96ca455c66c08cb002d145f61a8ce2e}{00031}}   int16\_t \mbox{\hyperlink{class_health_monitor_ac96ca455c66c08cb002d145f61a8ce2e}{sense\_values}}[8]; \textcolor{comment}{// Filter samples}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00041}\mbox{\hyperlink{class_health_monitor_a442c08fc3c8011515c01b735deba53ae}{00041}}   \mbox{\hyperlink{class_health_monitor_a442c08fc3c8011515c01b735deba53ae}{HealthMonitor}}(uint16\_t thres, uint8\_t inc, uint8\_t dec, uint16\_t lim)}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00042}00042   \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00043}00043     \mbox{\hyperlink{class_health_monitor_a74cb75281de6403101b1532d82d083da}{threshold}} = thres;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00044}00044     \mbox{\hyperlink{class_health_monitor_a2105621201b3b30dc9aa941fbbda38cd}{rampUPinc}} = inc;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00045}00045     \mbox{\hyperlink{class_health_monitor_aa966d7d0797fd39871e4985e0cc06eb0}{rampDOWNdec}} = dec;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00046}00046     \mbox{\hyperlink{class_health_monitor_a5c26a9b437db52f219e333f42248417f}{limit}} = lim;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00047}00047     counter = 0;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00048}00048   \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00054}\mbox{\hyperlink{class_health_monitor_a8ef42b9203777a467dfe18c4bbe5d17e}{00054}}   \textcolor{keywordtype}{void} \mbox{\hyperlink{class_health_monitor_a8ef42b9203777a467dfe18c4bbe5d17e}{setCounter}}(uint16\_t value)}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00055}00055   \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00056}00056     counter = constrain(value, 0, UINT16\_MAX -\/ 1);}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00057}00057   \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00058}00058 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00064}\mbox{\hyperlink{class_health_monitor_a1a0d1aacaaa44cf60e88b33bc86b2eb4}{00064}}   uint16\_t \mbox{\hyperlink{class_health_monitor_a1a0d1aacaaa44cf60e88b33bc86b2eb4}{getCounter}}()}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00065}00065   \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00066}00066     uint16\_t percent;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00067}00067 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00068}00068     percent = counter * 100 / \mbox{\hyperlink{_health_monitor_8h_a9d401d356b9137e774ca9b0dc4792f9c}{C\_COUNTER\_LIMIT}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00069}00069 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00070}00070     \textcolor{keywordflow}{return} percent;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00071}00071   \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00072}00072 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00079}\mbox{\hyperlink{class_health_monitor_acaa0f055c81672ecdd0ccd6c2fb838ca}{00079}}   \textcolor{keywordtype}{boolean} \mbox{\hyperlink{class_health_monitor_acaa0f055c81672ecdd0ccd6c2fb838ca}{check}}(uint16\_t \mbox{\hyperlink{0005-_s_e_n_s_i_n_g_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a557cbeabffc4ae613e1db945c13d140b}{sample}})}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00080}00080   \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00081}00081 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00082}00082     \textcolor{keywordflow}{if} (\mbox{\hyperlink{0005-_s_e_n_s_i_n_g_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a557cbeabffc4ae613e1db945c13d140b}{sample}} > \mbox{\hyperlink{class_health_monitor_a74cb75281de6403101b1532d82d083da}{threshold}})}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00083}00083     \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00084}00084       counter = constrain(counter, 0, UINT16\_MAX -\/ \mbox{\hyperlink{class_health_monitor_a2105621201b3b30dc9aa941fbbda38cd}{rampUPinc}}); \textcolor{comment}{// prevent counter overflow before inc/dec}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00085}00085       counter = counter + \mbox{\hyperlink{class_health_monitor_a2105621201b3b30dc9aa941fbbda38cd}{rampUPinc}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00086}00086     \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00087}00087     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00088}00088     \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00089}00089       counter = constrain(counter, \mbox{\hyperlink{class_health_monitor_aa966d7d0797fd39871e4985e0cc06eb0}{rampDOWNdec}}, UINT16\_MAX -\/ \mbox{\hyperlink{class_health_monitor_a2105621201b3b30dc9aa941fbbda38cd}{rampUPinc}}); \textcolor{comment}{// prevent counter overflow before inc/dec}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00090}00090       counter = counter -\/ \mbox{\hyperlink{class_health_monitor_aa966d7d0797fd39871e4985e0cc06eb0}{rampDOWNdec}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00091}00091     \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00092}00092 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00093}00093     \textcolor{keywordflow}{if} (counter >= \mbox{\hyperlink{class_health_monitor_a5c26a9b437db52f219e333f42248417f}{limit}})}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00094}00094     \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00095}00095       counter = constrain(counter, \mbox{\hyperlink{class_health_monitor_aa966d7d0797fd39871e4985e0cc06eb0}{rampDOWNdec}}, \mbox{\hyperlink{class_health_monitor_a5c26a9b437db52f219e333f42248417f}{limit}});}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00096}00096       \mbox{\hyperlink{class_health_monitor_a2a0e47f0300e57780b8c2eff36b1a300}{alarm}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00097}00097     \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00098}00098     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00099}00099     \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00100}00100       \mbox{\hyperlink{class_health_monitor_a2a0e47f0300e57780b8c2eff36b1a300}{alarm}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00101}00101     \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00102}00102     \textcolor{keywordflow}{return} (\mbox{\hyperlink{class_health_monitor_a2a0e47f0300e57780b8c2eff36b1a300}{alarm}});}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00103}00103   \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00104}00104 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00111}\mbox{\hyperlink{class_health_monitor_acebd76142707e393d35c46c1f4f488ec}{00111}}   uint16\_t \mbox{\hyperlink{class_health_monitor_acebd76142707e393d35c46c1f4f488ec}{getSample}}(uint16\_t ADCpin)}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00112}00112   \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00113}00113     \mbox{\hyperlink{batt___s_a_m_d___analog_correction_8cpp_a18f59c674a1d116e87341e6a0db0efca}{analogReadCorrection}}(12, 2055);}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00114}00114     analogReadResolution(12); \textcolor{comment}{// Set analog input resolution to max, 12-\/bits}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00115}00115     int16\_t out\_sample = 0;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00116}00116     int16\_t \mbox{\hyperlink{0005-_s_e_n_s_i_n_g_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a557cbeabffc4ae613e1db945c13d140b}{sample}} = 0;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00117}00117     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{0003-_b_u_z_z_e_r_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a752abcfe7ce5874cd9e8012a0346a37b}{i}} = (\textcolor{keyword}{sizeof}(\mbox{\hyperlink{class_health_monitor_ac96ca455c66c08cb002d145f61a8ce2e}{sense\_values}}) / \textcolor{keyword}{sizeof}(\mbox{\hyperlink{class_health_monitor_ac96ca455c66c08cb002d145f61a8ce2e}{sense\_values}}[0])) -\/ 1; \mbox{\hyperlink{0003-_b_u_z_z_e_r_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a752abcfe7ce5874cd9e8012a0346a37b}{i}} >= 1; \mbox{\hyperlink{0003-_b_u_z_z_e_r_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a752abcfe7ce5874cd9e8012a0346a37b}{i}}-\/-\/)}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00118}00118     \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00119}00119       \mbox{\hyperlink{class_health_monitor_ac96ca455c66c08cb002d145f61a8ce2e}{sense\_values}}[\mbox{\hyperlink{0003-_b_u_z_z_e_r_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a752abcfe7ce5874cd9e8012a0346a37b}{i}}] = \mbox{\hyperlink{class_health_monitor_ac96ca455c66c08cb002d145f61a8ce2e}{sense\_values}}[\mbox{\hyperlink{0003-_b_u_z_z_e_r_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a752abcfe7ce5874cd9e8012a0346a37b}{i}} -\/ 1];}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00120}00120       out\_sample += \mbox{\hyperlink{class_health_monitor_ac96ca455c66c08cb002d145f61a8ce2e}{sense\_values}}[\mbox{\hyperlink{0003-_b_u_z_z_e_r_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a752abcfe7ce5874cd9e8012a0346a37b}{i}}];}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00121}00121     \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00122}00122 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00123}00123     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} \mbox{\hyperlink{0003-_b_u_z_z_e_r_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a752abcfe7ce5874cd9e8012a0346a37b}{i}} = 0; \mbox{\hyperlink{0003-_b_u_z_z_e_r_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a752abcfe7ce5874cd9e8012a0346a37b}{i}} < 8; \mbox{\hyperlink{0003-_b_u_z_z_e_r_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a752abcfe7ce5874cd9e8012a0346a37b}{i}}++)}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00124}00124     \{}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00125}00125       \mbox{\hyperlink{0005-_s_e_n_s_i_n_g_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a557cbeabffc4ae613e1db945c13d140b}{sample}} += analogRead(ADCpin);}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00126}00126     \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00127}00127 }
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00128}00128     \mbox{\hyperlink{0005-_s_e_n_s_i_n_g_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a557cbeabffc4ae613e1db945c13d140b}{sample}} = (\mbox{\hyperlink{0005-_s_e_n_s_i_n_g_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a557cbeabffc4ae613e1db945c13d140b}{sample}} / 8 + out\_sample) / 8;}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00129}00129     \mbox{\hyperlink{class_health_monitor_ac96ca455c66c08cb002d145f61a8ce2e}{sense\_values}}[0] = \mbox{\hyperlink{0005-_s_e_n_s_i_n_g_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a557cbeabffc4ae613e1db945c13d140b}{sample}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00130}00130     \textcolor{keywordflow}{return} \mbox{\hyperlink{0005-_s_e_n_s_i_n_g_2examples_2_t_e_s_t__0_2_t_e_s_t__0_8ino_a557cbeabffc4ae613e1db945c13d140b}{sample}};}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00131}00131   \}}
\DoxyCodeLine{\Hypertarget{_health_monitor_8h_source_l00132}00132 \};}

\end{DoxyCode}
